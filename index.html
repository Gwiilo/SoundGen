<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Procedural Sound Creation</title>
    <link rel="stylesheet" href="styles.css">
  </head>
  <body>
    <div id="controlPanel">
      <!-- Main scrollable content area -->
      <div class="panel-content">
        <h2>Procedural Sound Creator</h2>
        
        <!-- Sound Key Input -->
        <div class="key-input">
          <label for="soundKeyInput">Sound Key:</label>
          <div class="input-group">
            <input type="text" id="soundKeyInput" placeholder="Enter sound key...">
            <button type="button" id="loadKeyButton" onclick="loadSoundKey()">Load</button>
          </div>
        </div>
        
        <!-- Replace Sound Type Selector with Preset Selector -->
        <form id="soundForm">
          <fieldset>
            <legend>Sound Preset</legend>
            
            <div class="preset-selector">
              <div class="preset-categories">
                <label for="presetCategory">Category:</label>
                <select id="presetCategory" name="presetCategory">
                  <option value="all">All Presets</option>
                  <!-- Categories will be loaded from presets.json -->
                </select>
              </div>
              
              <div class="preset-items">
                <label for="presetSelector">Preset:</label>
                <select id="presetSelector" name="presetSelector">
                  <option value="custom">Custom Parameters</option>
                  <!-- Presets will be loaded from presets.json -->
                </select>
              </div>
              
              <div class="preset-info">
                <div id="presetDescription" class="preset-description"></div>
              </div>
            </div>
            
            <!-- Parameter Selection UI remains unchanged -->
            <div class="parameter-selection">
              <label>Active Parameters:</label>
              <div class="parameter-tags" id="selectedParameters">
                <!-- Parameters will be added here dynamically -->
              </div>
              <button type="button" id="addParameterBtn" class="add-param-btn">+</button>
            </div>
            
            <div class="preset-actions">
              <button type="button" id="randomizeBtn" class="secondary-btn" onclick="randomizeParameters()">Randomize Parameters</button>
              <button type="button" id="savePresetBtn" class="secondary-btn" onclick="showSavePresetModal()">Save Current as Preset</button>
            </div>
          </fieldset>

          <!-- Sound Parameters Container remains unchanged -->
          <div id="parametersContainer">
            <!-- WIND Specific Parameters - now with collapsed class -->
            <fieldset id="windParams" class="sound-params collapsible-section collapsed">
              <legend class="collapse-toggle">Wind Parameters <span class="collapse-icon">▼</span></legend>
              <div class="collapsible-content">
                <label for="windSpeed">Wind Speed (0–100):</label>
                <input type="number" id="windSpeed" name="windSpeed" min="0" max="100" value="40">
                <label for="windGustiness">Gustiness (0.0–1.0):</label>
                <input type="number" id="windGustiness" name="windGustiness" step="0.1" min="0" max="1" value="0.5">
                <label for="windDirection">Wind Direction:</label>
                <select id="windDirection" name="windDirection">
                  <option value="N">North</option>
                  <option value="NE">North-East</option>
                  <option value="E">East</option>
                  <option value="SE">South-East</option>
                  <option value="S">South</option>
                  <option value="SW">South-West</option>
                  <option value="W">West</option>
                  <option value="NW">North-West</option>
                </select>
                <label for="turbulence">Turbulence (0.0–1.0):</label>
                <input type="number" id="turbulence" name="turbulence" step="0.1" min="0" max="1" value="0.3">
                <label for="groundMaterial">Ground Material:</label>
                <select id="groundMaterial" name="groundMaterial">
                  <option value="grass">Grass</option>
                  <option value="snow">Snow</option>
                  <option value="rock">Rock</option>
                  <option value="sand">Sand</option>
                </select>
              </div>
            </fieldset>

            <!-- OCEAN Specific Parameters - now with collapsed class -->
            <fieldset id="oceanParams" class="sound-params collapsible-section collapsed" style="display:none;">
              <legend class="collapse-toggle">Ocean Waves <span class="collapse-icon">▼</span></legend>
              <div class="collapsible-content">
                <label for="waveHeight">Wave Height (0–100):</label>
                <input type="range" id="waveHeight" name="waveHeight" min="0" max="100" value="60" class="slider" oninput="updateParamOutput('waveHeight')">
                <span class="param-value" id="waveHeightOutput">60</span>
                
                <label for="waveFrequency">Wave Frequency (0.1–2.0):</label>
                <input type="range" id="waveFrequency" name="waveFrequency" step="0.1" min="0.1" max="2" value="0.5" class="slider" oninput="updateParamOutput('waveFrequency')">
                <span class="param-value" id="waveFrequencyOutput">0.5</span>
                
                <label for="surfIntensity">Surf Intensity (0.0–1.0):</label>
                <input type="range" id="surfIntensity" name="surfIntensity" step="0.1" min="0" max="1" value="0.7" class="slider" oninput="updateParamOutput('surfIntensity')">
                <span class="param-value" id="surfIntensityOutput">0.7</span>
                
                <label for="oceanDepth">Ocean Depth:</label>
                <select id="oceanDepth" name="oceanDepth">
                  <option value="shallow">Shallow</option>
                  <option value="medium" selected>Medium</option>
                  <option value="deep">Deep</option>
                </select>
              </div>
            </fieldset>

            <!-- LEAVES Specific Parameters - now with collapsed class -->
            <fieldset id="leavesParams" class="sound-params collapsible-section collapsed" style="display:none;">
              <legend class="collapse-toggle">Leaves Rustling <span class="collapse-icon">▼</span></legend>
              <div class="collapsible-content">
                <label for="rustleIntensity">Rustle Intensity (0.0–1.0):</label>
                <input type="number" id="rustleIntensity" name="rustleIntensity" step="0.1" min="0" max="1" value="0.5">
                <label for="leafType">Leaf Type:</label>
                <select id="leafType" name="leafType">
                  <option value="generic">Generic</option>
                  <option value="oak">Oak</option>
                  <option value="pine">Pine</option>
                  <option value="maple">Maple</option>
                  <option value="birch">Birch</option>
                </select>
                <label for="leafDensity">Leaf Density (0–100):</label>
                <input type="number" id="leafDensity" name="leafDensity" min="0" max="100" step="5" value="50">
              </div>
            </fieldset>

            <!-- FIRE Specific Parameters - now with collapsed class -->
            <fieldset id="fireParams" class="sound-params collapsible-section collapsed" style="display:none;">
              <legend class="collapse-toggle">Ambient Fire <span class="collapse-icon">▼</span></legend>
              <div class="collapsible-content">
                <label for="fireIntensity">Fire Intensity (0.0–1.0):</label>
                <input type="range" id="fireIntensity" name="fireIntensity" step="0.1" min="0" max="1" value="0.5" class="slider" oninput="updateParamOutput('fireIntensity')">
                <span class="param-value" id="fireIntensityOutput">0.5</span>
                
                <label for="crackleFrequency">Crackle Frequency (0–10):</label>
                <input type="range" id="crackleFrequency" name="crackleFrequency" step="0.5" min="0" max="10" value="5" class="slider" oninput="updateParamOutput('crackleFrequency')">
                <span class="param-value" id="crackleFrequencyOutput">5</span>
                
                <label for="crackleIntensity">Crackle Intensity (0.0–1.0):</label>
                <input type="range" id="crackleIntensity" name="crackleIntensity" step="0.1" min="0" max="1" value="0.6" class="slider" oninput="updateParamOutput('crackleIntensity')">
                <span class="param-value" id="crackleIntensityOutput">0.6</span>
                
                <label for="flickerSpeed">Flicker Speed (0.0–5.0):</label>
                <input type="range" id="flickerSpeed" name="flickerSpeed" step="0.1" min="0" max="5" value="1.0" class="slider" oninput="updateParamOutput('flickerSpeed')">
                <span class="param-value" id="flickerSpeedOutput">1.0</span>
                
                <label for="fuelType">Fuel Type:</label>
                <select id="fuelType" name="fuelType">
                  <option value="wood">Wood</option>
                  <option value="gas">Gas</option>
                  <option value="charcoal">Charcoal</option>
                </select>
                
                <label for="flameTemp">Flame Temperature:</label>
                <select id="flameTemp" name="flameTemp">
                  <option value="cool">Cool</option>
                  <option value="neutral">Neutral</option>
                  <option value="warm">Warm</option>
                </select>
              </div>
            </fieldset>

            <!-- FOOTSTEPS Specific Parameters - now with collapsed class -->
            <fieldset id="footstepsParams" class="sound-params collapsible-section collapsed" style="display:none;">
              <legend class="collapse-toggle">Footsteps <span class="collapse-icon">▼</span></legend>
              <div class="collapsible-content">
                <label for="footstepVolume">Footstep Volume (0.0–1.0):</label>
                <input type="number" id="footstepVolume" name="footstepVolume" step="0.1" min="0" max="1" value="0.6">
                <label for="stepFrequency">Step Frequency (steps/minute):</label>
                <input type="number" id="stepFrequency" name="stepFrequency" min="30" max="200" value="100">
                <label for="footwearType">Footwear Type:</label>
                <select id="footwearType" name="footwearType">
                  <option value="sneakers">Sneakers</option>
                  <option value="boots">Boots</option>
                  <option value="sandals">Sandals</option>
                  <option value="barefoot">Barefoot</option>
                </select>
                <label for="stepSurface">Surface Type:</label>
                <select id="stepSurface" name="stepSurface">
                  <option value="grass">Grass</option>
                  <option value="gravel">Gravel</option>
                  <option value="wood">Wood</option>
                  <option value="tile">Tile</option>
                </select>
              </div>
            </fieldset>

            <!-- SYNTHESIZER Parameters -->
            <fieldset id="synthesizerParams" class="sound-params collapsible-section collapsed" style="display:none;">
              <legend class="collapse-toggle">Synthesizer <span class="collapse-icon">▼</span></legend>
              <div class="collapsible-content">
                <label for="oscType">Oscillator Type:</label>
                <select id="oscType" name="oscType">
                  <option value="sine">Sine Wave</option>
                  <option value="square">Square Wave</option>
                  <option value="sawtooth">Sawtooth Wave</option>
                  <option value="triangle">Triangle Wave</option>
                  <option value="custom">Custom Waveform</option>
                </select>
                
                <label for="oscFrequency">Base Frequency (20-2000Hz):</label>
                <input type="range" id="oscFrequency" name="oscFrequency" min="20" max="2000" value="440" class="slider" oninput="updateParamOutput('oscFrequency')">
                <span class="param-value" id="oscFrequencyOutput">440</span>
                
                <label for="oscDetune">Detune (±100 cents):</label>
                <input type="range" id="oscDetune" name="oscDetune" min="-100" max="100" value="0" class="slider" oninput="updateParamOutput('oscDetune')">
                <span class="param-value" id="oscDetuneOutput">0</span>
                
                <label for="harmonic1">1st Harmonic Level (0.0-1.0):</label>
                <input type="range" id="harmonic1" name="harmonic1" step="0.01" min="0" max="1" value="0.5" class="slider" oninput="updateParamOutput('harmonic1')">
                <span class="param-value" id="harmonic1Output">0.5</span>
                
                <label for="harmonic2">2nd Harmonic Level (0.0-1.0):</label>
                <input type="range" id="harmonic2" name="harmonic2" step="0.01" min="0" max="1" value="0.3" class="slider" oninput="updateParamOutput('harmonic2')">
                <span class="param-value" id="harmonic2Output">0.3</span>
                
                <label for="harmonic3">3rd Harmonic Level (0.0-1.0):</label>
                <input type="range" id="harmonic3" name="harmonic3" step="0.01" min="0" max="1" value="0.1" class="slider" oninput="updateParamOutput('harmonic3')">
                <span class="param-value" id="harmonic3Output">0.1</span>
                
                <label for="noiseAmount">Noise Amount (0.0-1.0):</label>
                <input type="range" id="noiseAmount" name="noiseAmount" step="0.01" min="0" max="1" value="0.1" class="slider" oninput="updateParamOutput('noiseAmount')">
                <span class="param-value" id="noiseAmountOutput">0.1</span>
                
                <label for="lfoRate">LFO Rate (0.1-20Hz):</label>
                <input type="range" id="lfoRate" name="lfoRate" step="0.1" min="0.1" max="20" value="4" class="slider" oninput="updateParamOutput('lfoRate')">
                <span class="param-value" id="lfoRateOutput">4</span>
                
                <label for="lfoDepth">LFO Depth (0.0-1.0):</label>
                <input type="range" id="lfoDepth" name="lfoDepth" step="0.01" min="0" max="1" value="0.2" class="slider" oninput="updateParamOutput('lfoDepth')">
                <span class="param-value" id="lfoDepthOutput">0.2</span>
                
                <label for="lfoTarget">LFO Target:</label>
                <select id="lfoTarget" name="lfoTarget">
                  <option value="pitch">Pitch</option>
                  <option value="amplitude">Amplitude</option>
                  <option value="filter">Filter</option>
                </select>
                
                <!-- Additional synthesizer parameters -->
                <label for="filterType">Filter Type:</label>
                <select id="filterType" name="filterType">
                  <option value="lowpass">Low Pass</option>
                  <option value="highpass">High Pass</option>
                  <option value="bandpass">Band Pass</option>
                  <option value="notch">Notch</option>
                </select>
                
                <label for="filterCutoff">Filter Cutoff (50-8000Hz):</label>
                <input type="range" id="filterCutoff" name="filterCutoff" min="50" max="8000" value="2000" class="slider" oninput="updateParamOutput('filterCutoff')">
                <span class="param-value" id="filterCutoffOutput">2000</span>
                
                <label for="filterResonance">Filter Resonance (0.1-20):</label>
                <input type="range" id="filterResonance" name="filterResonance" step="0.1" min="0.1" max="20" value="1" class="slider" oninput="updateParamOutput('filterResonance')">
                <span class="param-value" id="filterResonanceOutput">1</span>
                
                <label for="envelopeAttack">Attack Time (0.001-2.0s):</label>
                <input type="range" id="envelopeAttack" name="envelopeAttack" step="0.001" min="0.001" max="2" value="0.1" class="slider" oninput="updateParamOutput('envelopeAttack')">
                <span class="param-value" id="envelopeAttackOutput">0.1</span>
                
                <label for="envelopeRelease">Release Time (0.001-5.0s):</label>
                <input type="range" id="envelopeRelease" name="envelopeRelease" step="0.001" min="0.001" max="5" value="0.5" class="slider" oninput="updateParamOutput('envelopeRelease')">
                <span class="param-value" id="envelopeReleaseOutput">0.5</span>
              </div>
            </fieldset>

            <!-- PERCUSSION Parameters -->
            <fieldset id="percussionParams" class="sound-params collapsible-section collapsed" style="display:none;">
              <legend class="collapse-toggle">Percussion <span class="collapse-icon">▼</span></legend>
              <div class="collapsible-content">
                <label for="impactSharpness">Impact Sharpness (0.0-1.0):</label>
                <input type="range" id="impactSharpness" name="impactSharpness" step="0.01" min="0" max="1" value="0.8" class="slider" oninput="updateParamOutput('impactSharpness')">
                <span class="param-value" id="impactSharpnessOutput">0.8</span>
                
                <label for="bodyResonance">Body Resonance (0.0-1.0):</label>
                <input type="range" id="bodyResonance" name="bodyResonance" step="0.01" min="0" max="1" value="0.5" class="slider" oninput="updateParamOutput('bodyResonance')">
                <span class="param-value" id="bodyResonanceOutput">0.5</span>
                
                <label for="decayLength">Decay Length (0.0-1.0):</label>
                <input type="range" id="decayLength" name="decayLength" step="0.01" min="0" max="1" value="0.3" class="slider" oninput="updateParamOutput('decayLength')">
                <span class="param-value" id="decayLengthOutput">0.3</span>
                
                <label for="pitchBend">Pitch Bend (0.0-1.0):</label>
                <input type="range" id="pitchBend" name="pitchBend" step="0.01" min="0" max="1" value="0.2" class="slider" oninput="updateParamOutput('pitchBend')">
                <span class="param-value" id="pitchBendOutput">0.2</span>
                
                <label for="materialHardness">Material Hardness (0.0-1.0):</label>
                <input type="range" id="materialHardness" name="materialHardness" step="0.01" min="0" max="1" value="0.7" class="slider" oninput="updateParamOutput('materialHardness')">
                <span class="param-value" id="materialHardnessOutput">0.7</span>
                
                <label for="materialDensity">Material Density (0.0-1.0):</label>
                <input type="range" id="materialDensity" name="materialDensity" step="0.01" min="0" max="1" value="0.6" class="slider" oninput="updateParamOutput('materialDensity')">
                <span class="param-value" id="materialDensityOutput">0.6</span>
                
                <!-- Additional percussion parameters -->
                <label for="percussionType">Percussion Type:</label>
                <select id="percussionType" name="percussionType">
                  <option value="drum">Drum</option>
                  <option value="woodblock">Woodblock</option>
                  <option value="metal">Metal</option>
                  <option value="membrane">Membrane</option>
                  <option value="glass">Glass</option>
                </select>
                
                <label for="strikeVelocity">Strike Velocity (0.1-1.0):</label>
                <input type="range" id="strikeVelocity" name="strikeVelocity" step="0.01" min="0.1" max="1" value="0.7" class="slider" oninput="updateParamOutput('strikeVelocity')">
                <span class="param-value" id="strikeVelocityOutput">0.7</span>
                
                <label for="strikePosition">Strike Position (0.0-1.0):</label>
                <input type="range" id="strikePosition" name="strikePosition" step="0.01" min="0" max="1" value="0.5" class="slider" oninput="updateParamOutput('strikePosition')">
                <span class="param-value" id="strikePositionOutput">0.5</span>
                
                <label for="resonantModes">Resonant Modes (1-5):</label>
                <input type="range" id="resonantModes" name="resonantModes" step="1" min="1" max="5" value="3" class="slider" oninput="updateParamOutput('resonantModes')">
                <span class="param-value" id="resonantModesOutput">3</span>
              </div>
            </fieldset>

            <!-- NOISE Parameters -->
            <fieldset id="noiseParams" class="sound-params collapsible-section collapsed" style="display:none;">
              <legend class="collapse-toggle">Advanced Noise <span class="collapse-icon">▼</span></legend>
              <div class="collapsible-content">
                <label for="noiseColor">Noise Color:</label>
                <select id="noiseColor" name="noiseColor">
                  <option value="white">White Noise</option>
                  <option value="pink">Pink Noise</option>
                  <option value="brown">Brown/Red Noise</option>
                  <option value="blue">Blue Noise</option>
                  <option value="violet">Violet Noise</option>
                  <option value="grey">Grey Noise</option>
                </select>
                
                <label for="noiseDensity">Noise Density (0.0-1.0):</label>
                <input type="range" id="noiseDensity" name="noiseDensity" step="0.01" min="0" max="1" value="0.7" class="slider" oninput="updateParamOutput('noiseDensity')">
                <span class="param-value" id="noiseDensityOutput">0.7</span>
                
                <label for="lowFreqContent">Low Frequency Content (0.0-1.0):</label>
                <input type="range" id="lowFreqContent" name="lowFreqContent" step="0.01" min="0" max="1" value="0.5" class="slider" oninput="updateParamOutput('lowFreqContent')">
                <span class="param-value" id="lowFreqContentOutput">0.5</span>
                
                <label for="highFreqContent">High Frequency Content (0.0-1.0):</label>
                <input type="range" id="highFreqContent" name="highFreqContent" step="0.01" min="0" max="1" value="0.5" class="slider" oninput="updateParamOutput('highFreqContent')">
                <span class="param-value" id="highFreqContentOutput">0.5</span>
                
                <label for="spectralTilt">Spectral Tilt (-12 to +12 dB/oct):</label>
                <input type="range" id="spectralTilt" name="spectralTilt" step="1" min="-12" max="12" value="-3" class="slider" oninput="updateParamOutput('spectralTilt')">
                <span class="param-value" id="spectralTiltOutput">-3</span>
                
                <!-- Additional noise parameters -->
                <label for="noiseModulation">Modulation Amount (0.0-1.0):</label>
                <input type="range" id="noiseModulation" name="noiseModulation" step="0.01" min="0" max="1" value="0.2" class="slider" oninput="updateParamOutput('noiseModulation')">
                <span class="param-value" id="noiseModulationOutput">0.2</span>
                
                <label for="noiseModRate">Modulation Rate (0.1-10Hz):</label>
                <input type="range" id="noiseModRate" name="noiseModRate" step="0.1" min="0.1" max="10" value="1.0" class="slider" oninput="updateParamOutput('noiseModRate')">
                <span class="param-value" id="noiseModRateOutput">1.0</span>
                
                <label for="bandpassCenter">Bandpass Center (100-8000Hz):</label>
                <input type="range" id="bandpassCenter" name="bandpassCenter" min="100" max="8000" value="1000" class="slider" oninput="updateParamOutput('bandpassCenter')">
                <span class="param-value" id="bandpassCenterOutput">1000</span>
                
                <label for="bandpassWidth">Bandpass Width (50-5000Hz):</label>
                <input type="range" id="bandpassWidth" name="bandpassWidth" min="50" max="5000" value="500" class="slider" oninput="updateParamOutput('bandpassWidth')">
                <span class="param-value" id="bandpassWidthOutput">500</span>
                
                <label for="noiseQuantization">Quantization (bits 1-16):</label>
                <input type="range" id="noiseQuantization" name="noiseQuantization" step="1" min="1" max="16" value="16" class="slider" oninput="updateParamOutput('noiseQuantization')">
                <span class="param-value" id="noiseQuantizationOutput">16</span>
              </div>
            </fieldset>

            <!-- MECHANICAL Parameters -->
            <fieldset id="mechanicalParams" class="sound-params collapsible-section collapsed" style="display:none;">
              <legend class="collapse-toggle">Mechanical Sounds <span class="collapse-icon">▼</span></legend>
              <div class="collapsible-content">
                <label for="rpm">RPM (60-1200):</label>
                <input type="range" id="rpm" name="rpm" min="60" max="1200" value="600" class="slider" oninput="updateParamOutput('rpm')">
                <span class="param-value" id="rpmOutput">600</span>
                
                <label for="gearRatio">Gear Ratio (0.1-2.0):</label>
                <input type="range" id="gearRatio" name="gearRatio" step="0.05" min="0.1" max="2" value="0.5" class="slider" oninput="updateParamOutput('gearRatio')">
                <span class="param-value" id="gearRatioOutput">0.5</span>
                
                <label for="friction">Friction (0.0-1.0):</label>
                <input type="range" id="friction" name="friction" step="0.01" min="0" max="1" value="0.3" class="slider" oninput="updateParamOutput('friction')">
                <span class="param-value" id="frictionOutput">0.3</span>
                
                <label for="metallic">Metallic Quality (0.0-1.0):</label>
                <input type="range" id="metallic" name="metallic" step="0.01" min="0" max="1" value="0.7" class="slider" oninput="updateParamOutput('metallic')">
                <span class="param-value" id="metallicOutput">0.7</span>
                
                <label for="mechanicalLooseness">Mechanical Looseness (0.0-1.0):</label>
                <input type="range" id="mechanicalLooseness" name="mechanicalLooseness" step="0.01" min="0" max="1" value="0.3" class="slider" oninput="updateParamOutput('mechanicalLooseness')">
                <span class="param-value" id="mechanicalLoosenessOutput">0.3</span>
                
                <!-- Additional mechanical parameters -->
                <label for="mechanicalType">Mechanism Type:</label>
                <select id="mechanicalType" name="mechanicalType">
                  <option value="motor">Electric Motor</option>
                  <option value="engine">Combustion Engine</option>
                  <option value="gears">Gear System</option>
                  <option value="belt">Belt Drive</option>
                  <option value="hydraulic">Hydraulic</option>
                </select>
                
                <label for="motorLoadFactor">Load Factor (0.0-1.0):</label>
                <input type="range" id="motorLoadFactor" name="motorLoadFactor" step="0.01" min="0" max="1" value="0.5" class="slider" oninput="updateParamOutput('motorLoadFactor')">
                <span class="param-value" id="motorLoadFactorOutput">0.5</span>
                
                <label for="rpmFluctuation">RPM Fluctuation (0.0-1.0):</label>
                <input type="range" id="rpmFluctuation" name="rpmFluctuation" step="0.01" min="0" max="1" value="0.2" class="slider" oninput="updateParamOutput('rpmFluctuation')">
                <span class="param-value" id="rpmFluctuationOutput">0.2</span>
                
                <label for="mechanicalResonance">Resonance Frequency (50-2000Hz):</label>
                <input type="range" id="mechanicalResonance" name="mechanicalResonance" min="50" max="2000" value="500" class="slider" oninput="updateParamOutput('mechanicalResonance')">
                <span class="param-value" id="mechanicalResonanceOutput">500</span>
                
                <label for="surfaceContact">Surface Contact (0.0-1.0):</label>
                <input type="range" id="surfaceContact" name="surfaceContact" step="0.01" min="0" max="1" value="0.4" class="slider" oninput="updateParamOutput('surfaceContact')">
                <span class="param-value" id="surfaceContactOutput">0.4</span>
              </div>
            </fieldset>

            <!-- FORMANT Parameters -->
            <fieldset id="formantParams" class="sound-params collapsible-section collapsed" style="display:none;">
              <legend class="collapse-toggle">Voice & Formant <span class="collapse-icon">▼</span></legend>
              <div class="collapsible-content">
                <label for="formant1">Formant 1 (200-800Hz):</label>
                <input type="range" id="formant1" name="formant1" min="200" max="800" value="500" class="slider" oninput="updateParamOutput('formant1')">
                <span class="param-value" id="formant1Output">500</span>
                
                <label for="formant2">Formant 2 (800-2400Hz):</label>
                <input type="range" id="formant2" name="formant2" min="800" max="2400" value="1500" class="slider" oninput="updateParamOutput('formant2')">
                <span class="param-value" id="formant2Output">1500</span>
                
                <label for="formant3">Formant 3 (1500-4000Hz):</label>
                <input type="range" id="formant3" name="formant3" min="1500" max="4000" value="2500" class="slider" oninput="updateParamOutput('formant3')">
                <span class="param-value" id="formant3Output">2500</span>
                
                <label for="breathiness">Breathiness (0.0-1.0):</label>
                <input type="range" id="breathiness" name="breathiness" step="0.01" min="0" max="1" value="0.3" class="slider" oninput="updateParamOutput('breathiness')">
                <span class="param-value" id="breathinessOutput">0.3</span>
                
                <label for="vocalTension">Vocal Tension (0.0-1.0):</label>
                <input type="range" id="vocalTension" name="vocalTension" step="0.01" min="0" max="1" value="0.5" class="slider" oninput="updateParamOutput('vocalTension')">
                <span class="param-value" id="vocalTensionOutput">0.5</span>
                
                <label for="vibrato">Vibrato Amount (0.0-1.0):</label>
                <input type="range" id="vibrato" name="vibrato" step="0.01" min="0" max="1" value="0.2" class="slider" oninput="updateParamOutput('vibrato')">
                <span class="param-value" id="vibratoOutput">0.2</span>
                
                <label for="vibratoRate">Vibrato Rate (0.5-10Hz):</label>
                <input type="range" id="vibratoRate" name="vibratoRate" step="0.1" min="0.5" max="10" value="5" class="slider" oninput="updateParamOutput('vibratoRate')">
                <span class="param-value" id="vibratoRateOutput">5</span>
                
                <!-- Additional formant parameters -->
                <label for="vocalPreset">Vowel Preset:</label>
                <select id="vocalPreset" name="vocalPreset">
                  <option value="a">A (as in "father")</option>
                  <option value="e">E (as in "bed")</option>
                  <option value="i">I (as in "see")</option>
                  <option value="o">O (as in "go")</option>
                  <option value="u">U (as in "soon")</option>
                </select>
                
                <label for="glottalOpenQuotient">Glottal Open Quotient (0.1-0.9):</label>
                <input type="range" id="glottalOpenQuotient" name="glottalOpenQuotient" step="0.01" min="0.1" max="0.9" value="0.6" class="slider" oninput="updateParamOutput('glottalOpenQuotient')">
                <span class="param-value" id="glottalOpenQuotientOutput">0.6</span>
                
                <label for="throatLength">Throat Length (0.5-1.5):</label>
                <input type="range" id="throatLength" name="throatLength" step="0.01" min="0.5" max="1.5" value="1.0" class="slider" oninput="updateParamOutput('throatLength')">
                <span class="param-value" id="throatLengthOutput">1.0</span>
                
                <label for="tonguePosition">Tongue Position (0.0-1.0):</label>
                <input type="range" id="tonguePosition" name="tonguePosition" step="0.01" min="0" max="1" value="0.5" class="slider" oninput="updateParamOutput('tonguePosition')">
                <span class="param-value" id="tonguePositionOutput">0.5</span>
                
                <label for="mouthOpening">Mouth Opening (0.0-1.0):</label>
                <input type="range" id="mouthOpening" name="mouthOpening" step="0.01" min="0" max="1" value="0.7" class="slider" oninput="updateParamOutput('mouthOpening')">
                <span class="param-value" id="mouthOpeningOutput">0.7</span>
              </div>
            </fieldset>

            <!-- Global Spatial Parameters - now with collapsed class -->
            <fieldset id="spatialParams" class="collapsible-section collapsed">
              <legend class="collapse-toggle">Spatial Parameters <span class="collapse-icon">▼</span></legend>
              <div class="collapsible-content">
                <label for="refDistance">Reference Distance (2–50):</label>
                <input type="number" id="refDistance" name="refDistance" min="2" max="50" value="5">
                <label for="rolloff">Rolloff Factor (0.1–5):</label>
                <input type="number" id="rolloff" name="rolloff" step="0.1" min="0.1" max="5" value="1">
                <label for="coneInner">Cone Inner Angle (0–180):</label>
                <input type="number" id="coneInner" name="coneInner" min="0" max="180" value="60">
                <label for="coneOuter">Cone Outer Angle (0–360):</label>
                <input type="number" id="coneOuter" name="coneOuter" min="0" max="360" value="180">
                <label for="coneOuterGain">Cone Outer Gain (0–1):</label>
                <input type="number" id="coneOuterGain" name="coneOuterGain" step="0.1" min="0" max="1" value="0.1">
              </div>
            </fieldset>
          </div>
        </form>
      </div>
      
      <!-- Fixed bottom section -->
      <div class="panel-footer">
        <div class="action-buttons">
          <button type="button" class="primary-btn" onclick="generateSoundKey()">Generate Sound Key</button>
          <div class="play-download-group">
            <button type="button" class="play-btn" onclick="playSoundFromUI()"><span>Play Sound</span></button>
            <button type="button" class="download-btn" onclick="downloadSoundFromUI()" title="Download Sound">↓</button>
          </div>
        </div>

        <div id="output-container">
          <h3>Sound Key:</h3>
          <p id="soundKeyDisplay" class="key-display"></p>
          <p id="playStatus"></p>
        </div>
        
        <div id="durationControl">
          <label for="playbackDuration">Playback Duration: <span id="durationValue">5</span> seconds</label>
          <input type="range" id="playbackDuration" min="1" max="60" value="5" class="slider" oninput="updateDurationDisplay(this.value)">
        </div>
      </div>
    </div>

    <!-- Three.js from a CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="script.js"></script>
  </body>
</html>
